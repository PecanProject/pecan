# Processing Cru-ncep data from MsTMIP

There are a number of different files in here, variously trying to do the following, but on different servers (including clusters that use modules and queuing systems). But the key steps are here:

### downloading from ornl

```
nohup ionice -n 7 wget -r -nH --cut-dirs=6 ftp://nacp.ornl.gov/synthesis/2009/frescati/model_driver/cru_ncep/analysis &
```

### transfer from pecandev to ebi-cluster

```
ionice -c2 -n7 rsync --rsync-path="ionice -c2 -n7 rsync" -routi --progress ./* ebi-cluster:met/cruncep/
```

### unzip

_note_ these are i/o and memory-intensive (need at least 16GB RAM; works better with 64!)

* [`gunzipall.sh`](https://github.com/PecanProject/pecan/blob/master/modules/data.atmosphere/inst/scripts/cruncep/gunzipall.sh) unzips files nicely

### concatenate

1. For each year, combine variables into one file per year
2. combine all years into a single file

* [`weather.sh`](https://github.com/PecanProject/pecan/blob/master/modules/data.atmosphere/inst/scripts/cruncep/weather.sh)

### rechunk

* this "probably" should be done before concatenating, so rechunking can be performed on smaller files (although we do have access to a 1TB large memory node if necessary) 
* [`permute_all.sh`](https://github.com/PecanProject/pecan/blob/master/modules/data.atmosphere/inst/scripts/cruncep/permute_all.sh) attempts to chunk for fast reading of time series (`permute.sh` does this for 1975-2010)
