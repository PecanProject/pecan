<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • PEcAn.priors</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PEcAn.priors</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/priors_demo.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1></h1>
            
      
      
      <div class="hidden name"><code>priors_demo.Rmd</code></div>

    </div>

    
    
<div id="generating-priors-based-on-data-and-or-expert-knowledge" class="section level1">
<h1 class="hasAnchor">
<a href="#generating-priors-based-on-data-and-or-expert-knowledge" class="anchor"></a>Generating Priors based on Data and / or Expert knowledge:</h1>
<div id="fitting-priors-to-data-point-estimates-all-grass-species-in-glopnet-" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-priors-to-data-point-estimates-all-grass-species-in-glopnet-" class="anchor"></a>Fitting priors to data (point estimates, all grass species in GLOPNET).</h2>
<div id="example-specific-leaf-area-based-on-all-grasses" class="section level3">
<h3 class="hasAnchor">
<a href="#example-specific-leaf-area-based-on-all-grasses" class="anchor"></a>Example: Specific Leaf Area based on all grasses</h3>
</div>
<div id="mle-fit-to-glopnet-specific-leaf-area-data" class="section level3">
<h3 class="hasAnchor">
<a href="#mle-fit-to-glopnet-specific-leaf-area-data" class="anchor"></a>MLE Fit to glopnet Specific Leaf Area data</h3>
<p>fit.dist function is in <code><a href="../reference/fit.dist.html">PEcAn.priors::fit.dist</a></code> (See source code: <a href="https://github.com/PecanProject/pecan/blob/master/modules/priors/R/priors.R" class="uri">https://github.com/PecanProject/pecan/blob/master/modules/priors/R/priors.R</a>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"pecanproject/pecan/modules/priors"</span>)</code></pre></div>
<p>The <code>fit.dist</code> function takes a vector of point estimates (in this case 125 observations of Specific Leaf Area from GLOPNET database are stored in <code>sladata</code>.</p>
<p>First, it prints out the fits of a subset of distributions (the ‘f’ distribution could not be fit). Second, it prints the</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dists =<span class="st">  </span><span class="kw">c</span>(<span class="st">'gamma'</span>, <span class="st">'lognormal'</span>,<span class="st">'weibull'</span>, <span class="st">'f'</span>)
<span class="kw"><a href="../reference/fit.dist.html">fit.dist</a></span>(sladata, dists )</code></pre></div>
<p>The <code>priorfig</code> function visualizes the chosen prior (line), with its mean and 95%CI (dots) as well as the data used to generate the figure.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## priorfig(priordata = sladata, 
##                                                  priordensity = slaprior, 
##                                                  trait = 'SLA')
<span class="kw">print</span>(prior.figures<span class="op">$</span>SLA)</code></pre></div>
</div>
</div>
<div id="fitting-priors-to-data-with-uncertainty-estimates-generating-posterior-predictive-distribution-of-an-unobserved-c4-grass-species-based-on-values-collected-from-many-pfts-" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-priors-to-data-with-uncertainty-estimates-generating-posterior-predictive-distribution-of-an-unobserved-c4-grass-species-based-on-values-collected-from-many-pfts-" class="anchor"></a>Fitting priors to data with uncertainty estimates (generating posterior predictive distribution of an unobserved C4 grass species based on values collected from many PFTs.</h2>
<div id="vcmax-data-from-wullschleger-1993" class="section level3">
<h3 class="hasAnchor">
<a href="#vcmax-data-from-wullschleger-1993" class="anchor"></a>Vcmax data from Wullschleger (1993)</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wullschleger.data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">'inst/extdata/wullschleger1993updated.csv'</span>)</code></pre></div>
</div>
<div id="classify-wullschleger-data-into-functional-types" class="section level3">
<h3 class="hasAnchor">
<a href="#classify-wullschleger-data-into-functional-types" class="anchor"></a>Classify Wullschleger Data into Functional Types</h3>
<div id="query-functional-types-from-bety" class="section level4">
<h4 class="hasAnchor">
<a href="#query-functional-types-from-bety" class="anchor"></a>1. query functional types from BETY</h4>
<p>This code is not run here - data are provided in .csv file below. This code requires connection to the BETYdb MySQL server.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wullschleger.species &lt;-<span class="st"> </span><span class="kw">vecpaste</span>(<span class="kw">unique</span>(wullschleger.data<span class="op">$</span>AcceptedSymbol))
## load functional type data from BETY
con &lt;-<span class="st"> </span><span class="cf">function</span>() {<span class="kw">query.bety.con</span>(<span class="dt">username =</span> <span class="st">"bety"</span>, <span class="dt">password =</span> <span class="st">"bety"</span>, 
                                   <span class="dt">host =</span> <span class="st">"localhost"</span>, <span class="dt">dbname =</span> <span class="st">"bety"</span>)}
functional.data &lt;-<span class="st"> </span><span class="kw">query.bety</span>(<span class="kw">paste</span>(<span class="st">"select distinct AcceptedSymbol, scientificname, GrowthHabit, Category from species where AcceptedSymbol in ("</span>, wullschleger.species, <span class="st">") and GrowthHabit is not NULL and Category is not NULL;"</span>), <span class="kw">con</span>())
<span class="kw">write.csv</span>(functional.data, <span class="st">'inst/extdata/wullschleger_join_usdaplants.csv'</span>)</code></pre></div>
<p>Picking up with the Wullschleger dataset joined to USDA Plants functional type classifications …</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">functional.data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">'inst/extdata/wullschleger_join_usdaplants.csv'</span>)

subshrubs &lt;-<span class="st"> </span><span class="kw">rownames</span>(wullschleger.data) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="kw">grep</span>(<span class="st">'Shrub'</span>,wullschleger.data<span class="op">$</span>GrowthHabit), <span class="kw">grep</span>(<span class="st">'Subshrub'</span>, wullschleger.data<span class="op">$</span>GrowthHabit))
########## 2. Merge functional type information into Wullschleger data
wullschleger.data &lt;-<span class="st"> </span><span class="kw">merge</span>(wullschleger.data, functional.data, <span class="dt">by =</span> <span class="st">'AcceptedSymbol'</span>)
########## 3. Classify by functional type
## grass: any Graminoid Monocot
grass &lt;-<span class="st"> </span><span class="kw">with</span>(wullschleger.data, GrowthHabit <span class="op">==</span><span class="st"> 'Graminoid'</span> <span class="op">&amp;</span><span class="st"> </span>Category <span class="op">==</span><span class="st"> 'Monocot'</span>)
## forbs/herbs = forb
forb &lt;-<span class="st"> </span><span class="kw">with</span>(wullschleger.data, GrowthHabit <span class="op">==</span><span class="st"> 'Forb/herb'</span> <span class="op">|</span><span class="st"> </span>GrowthHabit <span class="op">==</span><span class="st"> 'Vine, Forb/herb'</span>)
## woody = Shrubs, Subshrubs or Trees, add category to a few with missing information, 
woody &lt;-<span class="st"> </span><span class="kw">with</span>(wullschleger.data, scientificname <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">'Acacia ligulata'</span>, <span class="st">'Acacia mangium'</span>, <span class="st">'Arbutus unedo'</span>, <span class="st">'Eucalyptus pauciflora'</span>, <span class="st">'Malus'</span>, <span class="st">'Salix'</span>) <span class="op">|</span><span class="st">  </span><span class="kw">rownames</span>(wullschleger.data) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="kw">grep</span>(<span class="st">'Shrub'</span>, GrowthHabit), <span class="kw">grep</span>(<span class="st">'Subshrub'</span>, GrowthHabit), <span class="kw">grep</span>(<span class="st">'Tree'</span>, GrowthHabit)))
## gymnosperms
gymnosperm &lt;-<span class="st"> </span>wullschleger.data<span class="op">$</span>Category <span class="op">==</span><span class="st"> 'Gymnosperm'</span>
## ambiguous is both woody and herbaceous, will drop
ambiguous &lt;-<span class="st"> </span>wullschleger.data<span class="op">$</span>GrowthHabit <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"Subshrub, Shrub, Forb/herb, Tree"</span>, <span class="st">"Tree, Subshrub, Shrub"</span>, <span class="st">"Tree, Shrub, Subshrub, Forb/herb"</span>, <span class="st">"Subshrub, Forb/herb"</span>)

wullschleger.data<span class="op">$</span>functional.type[grass] &lt;-<span class="st"> </span><span class="dv">1</span>
wullschleger.data<span class="op">$</span>functional.type[forb]  &lt;-<span class="st"> </span><span class="dv">3</span>
wullschleger.data<span class="op">$</span>functional.type[woody <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>gymnosperm] &lt;-<span class="st"> </span><span class="dv">4</span>
wullschleger.data<span class="op">$</span>functional.type[woody <span class="op">&amp;</span><span class="st"> </span>gymnosperm] &lt;-<span class="st"> </span><span class="dv">5</span>
wullschleger.data &lt;-<span class="st"> </span><span class="kw">subset</span>(wullschleger.data, <span class="op">!</span>ambiguous)     

############# Estimating SE and n ##################################
##verr, jerr: the "asymptotic" errors for Vcmax, Jmax using SAS nlim
##vucl,vlcl,jlcl,jucl: are upper and lower confidence limits of 95%CI

##Calculate SD as (1/2 the 95%CI)/1.96
wullschleger.data<span class="op">$</span>vsd &lt;-<span class="st"> </span>(wullschleger.data<span class="op">$</span>vucl<span class="op">-</span>wullschleger.data<span class="op">$</span>vlcl)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span><span class="fl">1.96</span>)

##Calculate effective N as (SE/SD)^2 + 1
wullschleger.data<span class="op">$</span>neff &lt;-<span class="st"> </span>(wullschleger.data<span class="op">$</span>vse<span class="op">/</span>wullschleger.data<span class="op">$</span>vsd)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
wullschleger.data<span class="op">$</span>se   &lt;-<span class="st"> </span><span class="kw">sqrt</span>(wullschleger.data<span class="op">$</span>vsd<span class="op">*</span><span class="kw">sqrt</span>(wullschleger.data<span class="op">$</span>neff))
## recode species to numeric
species &lt;-<span class="st"> </span><span class="kw">unique</span>(wullschleger.data<span class="op">$</span>scientificname)
sp &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">nrow</span>(wullschleger.data))
<span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq</span>(species)){
  sp[wullschleger.data<span class="op">$</span>scientificname <span class="op">==</span><span class="st"> </span>species[i]] &lt;-<span class="st"> </span>i
} 

############# Scale values to 25C ##################################
wullschleger.data<span class="op">$</span>corrected.vcmax &lt;-<span class="st"> </span><span class="kw">arrhenius.scaling</span>(wullschleger.data<span class="op">$</span>vcmax, 
                                     <span class="dt">old.temp =</span> wullschleger.data<span class="op">$</span>temp, 
                                     <span class="dt">new.temp =</span> <span class="dv">25</span>)

############# Create data.frame for JAGS model ##################################
wullschleger.data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Y  =</span> wullschleger.data<span class="op">$</span>corrected.vcmax,
                                <span class="dt">obs.prec =</span> <span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="kw">sqrt</span>(wullschleger.data<span class="op">$</span>neff) <span class="op">*</span><span class="st"> </span>wullschleger.data<span class="op">$</span>se),
                                <span class="dt">sp =</span> sp,
                                <span class="dt">ft =</span> wullschleger.data<span class="op">$</span>functional.type,
                                <span class="dt">n  =</span> wullschleger.data<span class="op">$</span>neff)
## Summarize data by species
wullschleger.vcmax &lt;-<span class="st"> </span><span class="kw">ddply</span>(wullschleger.data, 
                            .(sp),
                            summarise, 
                            <span class="dt">Y =</span> <span class="kw">mean</span>(Y), 
                            <span class="dt">obs.prec =</span> <span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">sum</span>((<span class="dv">1</span><span class="op">/</span>obs.prec)<span class="op">^</span><span class="dv">2</span>)), 
                            <span class="dt">ft =</span> <span class="kw">mean</span>(ft), <span class="co"># identity</span>
                            <span class="dt">n =</span>  <span class="kw">sum</span>(n)) [,<span class="op">-</span><span class="dv">1</span>]</code></pre></div>
<div id="add-data-from-c4-species" class="section level5">
<h5 class="hasAnchor">
<a href="#add-data-from-c4-species" class="anchor"></a>Add data from C4 species</h5>
<p>Few measurements of Vcmax for C4 species were available. ###### Miscanthus: Wang D, Maughan MW, Sun J, Feng X, Miguez FE, Lee DK, Dietze MC, 2011. Impact of canopy nitrogen allocation on growth and photosynthesis of miscanthus (Miscanthus x giganteus). Oecologia, in press</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dwang.vcmax &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">19.73</span>, <span class="fl">40.35</span>, <span class="fl">33.02</span>, <span class="fl">21.28</span>, <span class="fl">31.45</span>, <span class="fl">27.83</span>, <span class="fl">9.69</span>, <span class="fl">15.99</span>, <span class="fl">18.88</span>, <span class="fl">11.45</span>, <span class="fl">15.81</span>, <span class="fl">27.61</span>, <span class="dv">13</span>, <span class="fl">21.25</span>, <span class="fl">22.01</span>, <span class="fl">10.37</span>, <span class="fl">12.37</span>, <span class="fl">22.8</span>, <span class="fl">12.24</span>, <span class="fl">15.85</span>, <span class="fl">21.93</span>, <span class="fl">23.48</span>, <span class="fl">31.51</span>, <span class="fl">23.16</span>, <span class="fl">18.55</span>, <span class="fl">17.06</span>, <span class="fl">20.27</span>, <span class="fl">30.41</span>)
dwang.vcmax &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Y =</span> <span class="kw">mean</span>(dwang.vcmax), 
                          <span class="dt">obs.prec =</span> <span class="dv">1</span><span class="op">/</span><span class="kw">sd</span>(dwang.vcmax),
                          <span class="dt">ft =</span> <span class="dv">2</span>,         <span class="co">#C4 Grass</span>
                          <span class="dt">n =</span> <span class="kw">length</span>(dwang.vcmax))</code></pre></div>
<div id="muhlenbergia-glomerata" class="section level6">
<h6>Muhlenbergia glomerata</h6>
<p>Kubien and Sage 2004. Low-temperature photosynthetic performance of a C4 grass and a co-occurring C3 grass native to high latitudes. Plant, Cell &amp; Environment DOI: 10.1111/j.1365-3040.2004.01196.x</p>
<p>Data from figure 5 in Kubien and Sage (2004), average across plants grown at 14/10 degrees and 26/22 degrees</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kubien.vcmax &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Y =</span> <span class="kw">mean</span>(<span class="fl">23.4</span>, <span class="fl">24.8</span>), 
                           <span class="dt">obs.prec =</span> <span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="fl">2.6</span><span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="fl">2.5</span><span class="op">^</span><span class="dv">2</span>), 
                           <span class="dt">n =</span> <span class="dv">8</span>, 
                           <span class="dt">ft =</span> <span class="dv">2</span>)                      </code></pre></div>
</div>
<div id="zea-mays-corn" class="section level6">
<h6>Zea Mays (Corn)</h6>
<p>Massad, Tuzet, Bethenod 2007. The effect of temperature on C4-type leaf photosynthesis parameters. Plant, Cell &amp; Environment 30(9) 1191-1204. DOI: 10.1111/j.1365-3040.2007.01691.x</p>
<p>data from fig 6a</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">massad.vcmax.data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">vcmax =</span> <span class="kw">c</span>(<span class="fl">17.1</span>, <span class="fl">17.2</span>, <span class="fl">17.6</span>, <span class="dv">18</span>, <span class="fl">18.3</span>, <span class="fl">18.5</span>, <span class="fl">20.4</span>, <span class="fl">22.9</span>, <span class="fl">22.9</span>, <span class="fl">21.9</span>, <span class="fl">21.8</span>, <span class="fl">22.7</span>, <span class="fl">22.3</span>, <span class="fl">25.3</span>, <span class="fl">24.4</span>, <span class="fl">25.5</span>, <span class="fl">25.5</span>, <span class="fl">24.9</span>, <span class="fl">31.2</span>, <span class="fl">30.8</span>, <span class="fl">31.6</span>, <span class="fl">31.7</span>, <span class="fl">32.5</span>, <span class="fl">34.1</span>, <span class="fl">34.2</span>, <span class="fl">33.9</span>, <span class="fl">35.4</span>, <span class="dv">36</span>, <span class="dv">36</span>, <span class="fl">37.5</span>, <span class="fl">38.2</span>, <span class="fl">38.1</span>, <span class="fl">37.4</span>, <span class="fl">37.7</span>, <span class="fl">25.2</span>, <span class="fl">25.5</span>), 
                                <span class="dt">temp =</span> <span class="kw">c</span>(<span class="fl">20.5</span>, <span class="fl">24.6</span>, <span class="dv">21</span>, <span class="dv">19</span>, <span class="fl">21.9</span>, <span class="dv">15</span>, <span class="fl">19.6</span>, <span class="fl">14.3</span>, <span class="fl">20.8</span>, <span class="fl">23.4</span>, <span class="fl">24.8</span>, <span class="fl">25.9</span>, <span class="fl">24.1</span>, <span class="fl">22.8</span>, <span class="fl">27.9</span>, <span class="fl">31.7</span>, <span class="fl">35.5</span>, <span class="fl">39.3</span>, <span class="fl">37.9</span>, <span class="fl">42.4</span>, <span class="fl">41.5</span>, <span class="fl">48.7</span>, <span class="fl">33.3</span>, <span class="fl">33.3</span>, <span class="fl">31.5</span>, <span class="fl">39.1</span>, <span class="fl">38.8</span>, <span class="fl">43.3</span>, <span class="dv">50</span>, <span class="fl">38.4</span>, <span class="fl">35.7</span>, <span class="fl">34.4</span>, <span class="fl">31.9</span>, <span class="fl">33.9</span>, <span class="fl">32.1</span>, <span class="fl">33.7</span>))
massad.vcmax &lt;-<span class="st"> </span><span class="kw">with</span>(massad.vcmax.data, <span class="kw">arrhenius.scaling</span>(<span class="dt">old.temp =</span> temp, 
                                                          <span class="dt">new.temp =</span> <span class="dv">25</span>, 
                                                          <span class="dt">observed.value =</span> vcmax))

massad.vcmax &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Y  =</span> <span class="kw">mean</span>(massad.vcmax),
                           <span class="dt">obs.prec =</span> <span class="dv">1</span><span class="op">/</span>(<span class="kw">sd</span>(massad.vcmax)),
                           <span class="dt">n  =</span> <span class="kw">length</span>(massad.vcmax),
                           <span class="dt">ft =</span> <span class="dv">2</span>)

##### Combine all data sets
all.vcmax.data &lt;-<span class="st"> </span><span class="kw">rbind</span>(wullschleger.vcmax,
                        dwang.vcmax, 
                        ## xfeng.vcmax, 
                        kubien.vcmax, 
                        massad.vcmax)</code></pre></div>
</div>
</div>
<div id="take-a-look-at-the-raw-data-by-functional-type" class="section level5">
<h5 class="hasAnchor">
<a href="#take-a-look-at-the-raw-data-by-functional-type" class="anchor"></a>take a look at the raw data by functional type:</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span>(<span class="dt">data =</span> all.vcmax.data, <span class="dt">x =</span> <span class="kw">factor</span>(ft), <span class="dt">y =</span> Y, <span class="dt">geom =</span> <span class="st">'boxplot'</span>)</code></pre></div>
</div>
<div id="add-unobserved-c4-species-so-jags-calculates-posterior-predictive-distribution" class="section level5">
<h5 class="hasAnchor">
<a href="#add-unobserved-c4-species-so-jags-calculates-posterior-predictive-distribution" class="anchor"></a>Add unobserved C4 species so JAGS calculates posterior predictive distribution</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vcmax.data &lt;-<span class="st"> </span><span class="kw">rbind</span>(all.vcmax.data, 
                    <span class="kw">data.frame</span>(<span class="dt">Y =</span> <span class="ot">NA</span>, <span class="dt">obs.prec =</span> <span class="ot">NA</span>, <span class="dt">ft =</span> <span class="dv">2</span>, <span class="dt">n =</span> <span class="dv">1</span>))</code></pre></div>
</div>
<div id="write-and-run-meta-analysis" class="section level5">
<h5 class="hasAnchor">
<a href="#write-and-run-meta-analysis" class="anchor"></a>Write and Run Meta-analysis</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">writeLines</span>(<span class="dt">con =</span> <span class="st">"vcmax.prior.bug"</span>, 
           <span class="dt">text =</span>  <span class="st">"model{  </span>
<span class="st">             for (k in 1:length(Y)){</span>
<span class="st">               Y[k]  ~ dnorm(beta.ft[ft[k]], tau.y[k])T(0,)</span>
<span class="st">               tau.y[k] &lt;- prec.y*n[k]</span>
<span class="st">               u1[k] &lt;- n[k]/2                             </span>
<span class="st">               u2[k] &lt;- n[k]/(2*prec.y)</span>
<span class="st">               obs.prec[k] ~ dgamma(u1[k], u2[k])</span>
<span class="st">             }</span>
<span class="st">             for (f in 1:5){</span>
<span class="st">               beta.ft[f] ~ dnorm(0, tau.ft)</span>
<span class="st">             }</span>
<span class="st">             tau.ft ~ dgamma(0.1, 0.1)</span>
<span class="st">             prec.y    ~ dgamma(0.1, 0.1)     </span>
<span class="st">             sd.y      &lt;- 1 / sqrt(prec.y)</span>
<span class="st">             ## estimating posterior predictive for new C4 species</span>
<span class="st">             pi.pavi &lt;- Y[length(Y)]         </span>
<span class="st">             diff &lt;- beta.ft[1] - beta.ft[2]</span>
<span class="st">           }"</span>)

j.model  &lt;-<span class="st"> </span><span class="kw">jags.model</span>(<span class="dt">file =</span> <span class="st">"vcmax.prior.bug"</span>, 
                       <span class="dt">data =</span> vcmax.data, 
                       <span class="dt">n.adapt =</span> <span class="dv">500</span>, 
                       <span class="dt">n.chains =</span> <span class="dv">4</span>,
                       <span class="dt">inits =</span> inits)

mcmc.object &lt;-<span class="st"> </span><span class="kw">coda.samples</span>(<span class="dt">model =</span> j.model, <span class="dt">variable.names =</span> <span class="kw">c</span>(<span class="st">'pi.pavi'</span>, <span class="st">'beta.ft'</span>, <span class="st">'diff'</span>),
                            <span class="dt">n.iter =</span> iter)
mcmc.o     &lt;-<span class="st"> </span><span class="kw">window</span>(mcmc.object, <span class="dt">start =</span> iter<span class="op">/</span><span class="dv">2</span>, <span class="dt">thin =</span> <span class="dv">10</span>)
pi.pavi    &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">vcmax =</span> <span class="kw">unlist</span>(mcmc.o[,<span class="st">'pi.pavi'</span>]))
vcmax.dist &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit.dist.html">fit.dist</a></span>(pi.pavi, <span class="dt">n =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(vcmax.data<span class="op">$</span>Y)))

prior.dists   &lt;-<span class="st"> </span><span class="kw">rbind</span>(prior.dists, <span class="st">'Vcmax'</span> =<span class="st"> </span>vcmax.dist)
vcmax.density &lt;-<span class="st"> </span><span class="kw">with</span>(vcmax.dist, <span class="kw">prior.density</span>(distribution, a, b), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">50</span>))

######### Vcmax Prior Plot
vcmax.c4 &lt;-<span class="st"> </span>all.vcmax.data<span class="op">$</span>ft <span class="op">==</span><span class="st"> </span><span class="dv">2</span>
vcmax.data &lt;-<span class="st"> </span><span class="kw">transform</span>(all.vcmax.data, <span class="dt">mean =</span> Y, <span class="dt">se =</span>  <span class="dv">1</span><span class="op">/</span>(<span class="kw">sqrt</span>(n) <span class="op">*</span><span class="st"> </span>obs.prec))[,<span class="kw">c</span>(<span class="st">'ft'</span>, <span class="st">'mean'</span>, <span class="st">'se'</span>)]
<span class="co">#vcmax.mean &lt;- all.vcmax.data$Y[!c4,]</span>
<span class="co">#vcmax.se   &lt;- with(all.vcmax.data[!c4,], 1/(sqrt(n) * obs.prec))#[reorder]</span>
<span class="co">#c4.mean &lt;- all.vcmax.data$Y)[c4]</span>
<span class="co">#c4.se   &lt;- with(all.vcmax.data, 1 / (sqrt(n) * obs.prec) )[c4]</span>

prior.figures[[<span class="st">'Vcmax'</span>]] &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/priorfig.html">priorfig</a></span>(<span class="dt">priordensity =</span> vcmax.density, 
                                     <span class="dt">trait =</span> <span class="st">'Vcmax'</span>, 
                                     <span class="dt">xlim =</span> <span class="kw">range</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(vcmax.data<span class="op">$</span>mean)))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">subset</span>(vcmax.data, ft <span class="op">!=</span><span class="st"> </span><span class="dv">2</span>), 
             <span class="kw">aes</span>(<span class="dt">x=</span>mean, <span class="dt">y =</span> (<span class="kw">sum</span>(vcmax.c4) <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">sum</span>(<span class="op">!</span>vcmax.c4))<span class="op">/</span><span class="dv">3000</span>), <span class="dt">color =</span> <span class="st">'grey60'</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">data =</span> <span class="kw">subset</span>(vcmax.data, ft <span class="op">!=</span><span class="st"> </span><span class="dv">2</span>),
               <span class="kw">aes</span>(<span class="dt">x =</span> mean <span class="op">-</span><span class="st"> </span>se, <span class="dt">xend =</span> mean <span class="op">+</span><span class="st"> </span>se, 
                   <span class="dt">y =</span> (<span class="kw">sum</span>(vcmax.c4) <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">sum</span>(<span class="op">!</span>vcmax.c4))<span class="op">/</span><span class="dv">3000</span>, 
                   <span class="dt">yend =</span> (<span class="kw">sum</span>(vcmax.c4) <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">sum</span>(<span class="op">!</span>vcmax.c4))<span class="op">/</span><span class="dv">3000</span>),
               <span class="dt">color =</span> <span class="st">'grey60'</span>) <span class="op">+</span>
<span class="st">  </span>## darker color for C4 grasses
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">subset</span>(vcmax.data, ft <span class="op">==</span><span class="st"> </span><span class="dv">2</span>),
             <span class="kw">aes</span>(<span class="dt">x=</span>mean, <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">sum</span>(vcmax.c4)<span class="op">/</span><span class="dv">2000</span>), <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">data =</span> <span class="kw">subset</span>(vcmax.data, ft <span class="op">==</span><span class="st"> </span><span class="dv">2</span>),
               <span class="kw">aes</span>(<span class="dt">x =</span> mean <span class="op">-</span><span class="st"> </span>se, <span class="dt">xend =</span> mean <span class="op">+</span><span class="st"> </span>se, 
                   <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">sum</span>(vcmax.c4)<span class="op">/</span><span class="dv">2000</span>, <span class="dt">yend =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">sum</span>(vcmax.c4)<span class="op">/</span><span class="dv">2000</span>))

<span class="kw">print</span>(prior.figures[[<span class="st">'Vcmax'</span>]])</code></pre></div>
</div>
</div>
</div>
</div>
<div id="fitting-priors-to-expert-constraint--" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-priors-to-expert-constraint--" class="anchor"></a>Fitting priors to expert constraint ().</h2>
<div id="example-minimum-temperature-of-photosynthesis" class="section level3">
<h3 class="hasAnchor">
<a href="#example-minimum-temperature-of-photosynthesis" class="anchor"></a>Example: Minimum temperature of Photosynthesis</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TBD</code></pre></div>
</div>
</div>
<div id="other-examples-approaches" class="section level2">
<h2 class="hasAnchor">
<a href="#other-examples-approaches" class="anchor"></a>Other Examples / Approaches</h2>
<div id="examples" class="section level3">
<h3 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h3>
<ul>
<li>Estimating priors for the DALEC model in [models/dalec/inst/DALEC_priors.R](<a href="https://github.com/PecanProject/pecan/blob/master/models/dalec/inst/DALEC_priors.R" class="uri">https://github.com/PecanProject/pecan/blob/master/models/dalec/inst/DALEC_priors.R</a>
</li>
</ul>
</div>
<div id="package-rriskdistributions" class="section level3">
<h3 class="hasAnchor">
<a href="#package-rriskdistributions" class="anchor"></a>Package <code>rriskDistributions</code>
</h3>
<p>The <a href="http://cran.r-project.org/web/packages/rriskDistributions/index.html">rriskDistributions</a> useful for estimating priors …</p>
<p>as well as individual functions for each distribution such as <code>get.&lt;somedist&gt;.par</code> that provide nice diagnostic plots (e.g. compare chosen points to cdf) for example, to compute the parameters of a Gamma distribution that fits a median of 2.5 and has a 95%CI of [1, 10]:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rriskDistributions)
<span class="kw">get.gamma.par</span>(<span class="dt">p =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.50</span>, <span class="fl">0.975</span>), <span class="dt">q =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">2.5</span>, <span class="dv">10</span>), <span class="dt">tol =</span> <span class="fl">0.1</span>)</code></pre></div>
<p>The function <code>fit.pecr</code> provides a GUI to explore the fits of a range of distributions, e.g.:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fit.perc</span>(<span class="dt">p =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>), <span class="dt">q =</span> <span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>), <span class="dt">tolConv =</span> <span class="fl">0.1</span>)</code></pre></div>
<p>produces this:</p>
<div class="figure">
<img src="https://dl.dropboxusercontent.com/u/18092793/fit.perc_example.PNG" alt="image of rriskDistributions example that uses GUI"><p class="caption">image of rriskDistributions example that uses GUI</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#generating-priors-based-on-data-and-or-expert-knowledge">Generating Priors based on Data and / or Expert knowledge:</a><ul class="nav nav-pills nav-stacked">
<li><a href="#fitting-priors-to-data-point-estimates-all-grass-species-in-glopnet-">Fitting priors to data (point estimates, all grass species in GLOPNET).</a></li>
      <li><a href="#fitting-priors-to-data-with-uncertainty-estimates-generating-posterior-predictive-distribution-of-an-unobserved-c4-grass-species-based-on-values-collected-from-many-pfts-">Fitting priors to data with uncertainty estimates (generating posterior predictive distribution of an unobserved C4 grass species based on values collected from many PFTs.</a></li>
      <li><a href="#fitting-priors-to-expert-constraint--">Fitting priors to expert constraint ().</a></li>
      <li><a href="#other-examples-approaches">Other Examples / Approaches</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by .</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
